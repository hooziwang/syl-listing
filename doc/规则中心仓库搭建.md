# 规则中心仓库搭建

目标：把 Listing 规则从应用仓库拆分到独立仓库，规则可高频发布，客户端自动拉取。

## 1. 初始化独立规则仓库

在 `syl-listing` 项目根目录执行：

```bash
chmod +x scripts/init_rules_repo.sh
scripts/init_rules_repo.sh syl-listing-rules ~/work/syl-listing-rules --create-remote public
```

初始化后仓库会包含：

- `rules/title.yaml`
- `rules/bullets.yaml`
- `rules/description.yaml`
- `rules/search_terms.yaml`
- `.github/workflows/release.yml`
- `scripts/build_bundle.sh`

## 2. 发布规则版本

在规则仓库内：

```bash
git add .
git commit -m "feat: 更新 rules"
git tag rules-v2026.03.01
git push origin main --tags
```

工作流会自动创建 Release 并上传资产：

- `rules-bundle.tar.gz`

## 3. 客户端接入规则中心

`~/.syl-listing/config.yaml`：

```yaml
rules_center:
  enabled: true
  owner: hooziwang
  repo: syl-listing-rules
  release: latest
  asset: rules-bundle.tar.gz
  timeout_sec: 20
  strict: false
```

行为说明：

- `enabled=true`：启动时优先从规则中心同步。
- `strict=false`：同步失败时回退本地缓存规则继续运行。
- `strict=true`：同步失败直接报错退出。

